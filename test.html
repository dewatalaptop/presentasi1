<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dolan Sawah ‚Äî Strategic Data Intelligence System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<style>
/* ==========================================================================
   1. CORE VARIABLES & RESET
   ========================================================================== */
:root {
  /* Color Palette - Neon Cyberpunk Style */
  --bg-color: #050505;
  --text-main: #ffffff;
  --text-muted: rgba(255, 255, 255, 0.5);
  
  /* Brand Colors */
  --accent-green: #00ff99;  /* Hijau untuk Growth/Positive */
  --accent-blue: #33ccff;   /* Biru untuk Info/Neutral */
  --accent-red: #ff0050;    /* Merah untuk Alert/Attention */
  --accent-purple: #bc13fe; /* Ungu untuk Premium/Member */

  /* UI Components */
  --card-bg: rgba(20, 20, 20, 0.6);
  --card-border: 1px solid rgba(255, 255, 255, 0.1);
  --glass-blur: blur(12px);
  --transition-speed: 0.4s;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background-color: var(--bg-color);
  color: var(--text-main);
  overflow: hidden; /* Mencegah scrollbar browser, kita pakai slide */
  height: 100vh;
  width: 100vw;
}

/* ==========================================================================
   2. SLIDE ARCHITECTURE
   ========================================================================== */
.slide {
  display: none; /* Default hidden */
  height: 100vh;
  width: 100vw;
  padding: clamp(20px, 5vw, 60px);
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  transition: opacity 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.slide.active {
  display: flex;
  opacity: 1;
  z-index: 10;
  animation: slideIn 0.8s ease-out forwards;
}

@keyframes slideIn {
  from { transform: scale(1.05); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

/* Typography Scale */
h1 {
  font-size: clamp(36px, 6vw, 72px);
  margin-bottom: 20px;
  line-height: 1.1;
  letter-spacing: -1.5px;
  background: linear-gradient(to right, #fff, #aaa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

h2 {
  font-size: clamp(24px, 4vw, 42px);
  margin-bottom: 30px;
  font-weight: 600;
  color: #eeeeee;
}

h3 {
  font-size: 18px;
  text-transform: uppercase;
  letter-spacing: 2px;
  color: var(--text-muted);
  margin-bottom: 15px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding-bottom: 10px;
  width: 100%;
}

p {
  font-size: clamp(16px, 2vw, 22px);
  max-width: 900px;
  line-height: 1.6;
  color: var(--text-muted);
}

.highlight { color: var(--accent-green); font-weight: 700; }
.text-blue { color: var(--accent-blue); }
.text-red { color: var(--accent-red); }

/* ==========================================================================
   3. DASHBOARD COMPONENTS (GRID & CARDS)
   ========================================================================== */
.dashboard-container {
  width: 100%;
  max-width: 1200px;
  height: 80%; /* Mengisi sebagian besar layar */
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

.grid-2 {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 25px;
  width: 100%;
  height: 100%;
}

.grid-equal {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 25px;
  width: 100%;
  align-items: start;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-top: 20px;
}

.card {
  background: var(--card-bg);
  border: var(--card-border);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border-radius: 20px;
  padding: 25px;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

/* Efek Glow pada Card saat Hover */
.card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-green), transparent);
  opacity: 0.5;
}

/* ==========================================================================
   4. DATA VISUALIZATION ELEMENTS
   ========================================================================== */
.chart-box {
  position: relative;
  flex-grow: 1;
  width: 100%;
  min-height: 250px;
}

/* Big Numbers (KPI) */
.kpi-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
  gap: 20px;
}

.kpi-item {
  flex: 1;
  text-align: left;
  background: rgba(255,255,255,0.03);
  padding: 15px;
  border-radius: 12px;
}

.kpi-label {
  font-size: 12px;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 5px;
}

.kpi-value {
  font-size: 28px;
  font-weight: 700;
  color: #fff;
  font-feature-settings: "tnum"; /* Tabular numbers for alignment */
}

.kpi-sub {
  font-size: 11px;
  margin-top: 5px;
}

/* List Menu Styles */
ul.ranking-list {
  list-style: none;
  width: 100%;
  overflow-y: auto;
  max-height: 300px;
  padding-right: 5px;
}

ul.ranking-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

ul.ranking-list li:last-child { border-bottom: none; }

.rank-index {
  font-size: 12px;
  color: var(--accent-green);
  margin-right: 10px;
  font-family: monospace;
}

.rank-name {
  font-weight: 500;
  color: #ddd;
  flex-grow: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-right: 10px;
}

.rank-value {
  font-weight: 700;
  color: #fff;
}

/* ==========================================================================
   5. UTILITIES & ANIMATIONS
   ========================================================================== */
.loading-indicator {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-muted);
  margin-top: 15px;
  font-family: monospace;
}

.dot-pulse {
  width: 8px; height: 8px;
  background: var(--accent-green);
  border-radius: 50%;
  box-shadow: 0 0 10px var(--accent-green);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 0.5; transform: scale(0.9); }
  50% { opacity: 1; transform: scale(1.1); }
  100% { opacity: 0.5; transform: scale(0.9); }
}

/* Progress Bar Visuals */
.bar-container {
  width: 100%;
  background: rgba(255,255,255,0.1);
  height: 6px;
  border-radius: 3px;
  margin-top: 10px;
  overflow: hidden;
}
.bar-fill {
  height: 100%;
  background: var(--accent-green);
  width: 0%;
  transition: width 1.5s ease-out;
}

/* Background Cinematic Images */
.cinematic {
  background-size: cover;
  background-position: center;
}
.cinematic::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, #000 10%, rgba(0,0,0,0.4) 100%);
  z-index: 1;
}
.cinematic > * { position: relative; z-index: 2; }

/* Footer & Controls */
.controls {
  position: fixed;
  bottom: 30px;
  right: 30px;
  display: flex;
  gap: 15px;
  z-index: 100;
}
.btn-nav {
  width: 50px; height: 50px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.3);
  background: rgba(0,0,0,0.6);
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.3s;
}
.btn-nav:hover {
  background: var(--accent-green);
  color: #000;
  border-color: var(--accent-green);
}

.footer-info {
  position: fixed;
  bottom: 30px;
  left: 30px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  z-index: 100;
}
.footer-brand { font-size: 14px; font-weight: 700; letter-spacing: 1px; }
.footer-status { font-size: 11px; color: var(--text-muted); display: flex; align-items: center; gap: 5px; margin-top: 5px; }

</style>
</head>

<body>

<div class="slide active">
  <div style="margin-bottom: 20px; font-family: monospace; color: var(--accent-green); border:1px solid var(--accent-green); padding: 5px 15px; border-radius: 20px;">
    SYSTEM ONLINE // V.3.0
  </div>
  <h1>Dolan Sawah</h1>
  <p>Strategic Marketing & Real-Time Data Intelligence</p>
  
  <div class="loading-indicator" id="mainStatus">
    <div class="dot-pulse"></div>
    <span>Establishing secure connection to Firebase Firestore...</span>
  </div>
</div>

<div class="slide">
  <h2>The Reality Check</h2>
  <div class="dashboard-container" style="justify-content: center; height: auto;">
      <p>
        Musim liburan telah usai.<br>
        Trafik pengunjung menurun secara alami.<br>
        <span class="highlight">Ini bukan kegagalan, ini siklus.</span>
      </p>
  </div>
</div>

<div class="slide">
  <h1>Positioning Baru</h1>
  <p class="highlight" style="font-size: 32px;">‚ÄúThe Sanctuary After The Hype‚Äù</p>
  <p style="margin-top: 20px;">
    Saat kompetitor bertarung untuk viral sesaat (FOMO),<br>
    Dolan Sawah menjadi tempat untuk kenyamanan jangka panjang (JOMO).
  </p>
</div>

<div class="slide">
  <div class="dashboard-container">
    <h2>üìà Financial Trajectory (DP)</h2>
    
    <div class="grid-2">
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>Trend Pendapatan Down Payment</h3>
                <select style="background:none; color:#fff; border:1px solid #555; border-radius:5px; padding:2px;">
                    <option>Year to Date</option>
                </select>
            </div>
            <div class="chart-box">
                <canvas id="revenueChart"></canvas>
            </div>
            <div class="loading-indicator" id="statusRev">Updating Data...</div>
        </div>

        <div style="display: flex; flex-direction: column; gap: 20px;">
            <div class="card">
                <div class="kpi-label">Total Reservasi (YTD)</div>
                <div class="kpi-value" id="kpiTotalRes">0</div>
                <div class="kpi-sub text-blue">Data Terverifikasi</div>
            </div>
            
            <div class="card">
                <div class="kpi-label">Total Omzet DP</div>
                <div class="kpi-value highlight" id="kpiTotalRev">Rp 0</div>
                <div class="kpi-sub" id="kpiAvgTicket">Avg. Ticket: Rp 0</div>
            </div>

            <div class="card" style="background: rgba(0, 255, 153, 0.05); border-color: var(--accent-green);">
                <div class="kpi-label">Performance Note</div>
                <p style="font-size: 13px; color: #ddd; line-height: 1.4;">
                    Grafik di samping menunjukkan stabilitas booking. Pastikan gap antara Weekday dan Weekend tidak lebih dari 40%.
                </p>
            </div>
        </div>
    </div>
  </div>
</div>

<div class="slide">
  <div class="dashboard-container">
    <h2>üçΩÔ∏è Product Preference Analysis</h2>
    
    <div class="grid-equal">
        <div class="card">
            <h3>Top 7 Menu Favorites</h3>
            <div class="chart-box">
                <canvas id="menuChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>Detailed Menu Ranking</h3>
            <ul class="ranking-list" id="menuListDetail">
                <li style="text-align:center; padding: 20px; color: #555;">Loading Data...</li>
            </ul>
            <div style="margin-top: 15px; font-size: 12px; color: var(--text-muted); text-align: right;">
                *Data berdasarkan kuantitas item dalam reservasi
            </div>
        </div>
    </div>
  </div>
</div>

<div class="slide">
  <div class="dashboard-container">
    <h2>üì¢ Marketing Channel Attribution</h2>
    
    <div class="grid-2">
        <div class="card" style="align-items: center; justify-content: center;">
             <div class="chart-box" style="width: 80%;">
                <canvas id="sourceChart"></canvas>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; justify-content: center; gap: 25px;">
             <div class="card">
                 <div class="kpi-label">Total Database Member</div>
                 <div class="kpi-value text-blue" id="kpiTotalMember">0</div>
                 <div class="bar-container">
                     <div class="bar-fill" id="barVerified" style="width: 0%"></div>
                 </div>
                 <div class="kpi-sub" style="margin-top: 8px; display:flex; justify-content: space-between;">
                     <span>Verified WA</span>
                     <span id="txtVerified">0%</span>
                 </div>
             </div>

             <div class="card">
                 <h3>Actionable Insight</h3>
                 <p style="font-size: 14px;">
                    Jika <strong class="highlight">Instagram/TikTok</strong> mendominasi, berarti konten visual efektif.<br><br>
                    Jika <strong class="text-blue">Google Maps</strong> tinggi, SEO lokal berjalan baik.
                 </p>
             </div>
        </div>
    </div>
  </div>
</div>

<div class="slide">
  <div class="dashboard-container">
    <h2>üìç Geo-Demographic Mapping</h2>
    
    <div class="grid-3">
        <div class="card" style="text-align: center;">
            <div style="font-size: 40px; margin-bottom: 10px;">üèôÔ∏è</div>
            <div class="kpi-value" id="geoSemarang">0%</div>
            <div class="kpi-label">Core Market (Semarang)</div>
            <p style="font-size: 12px; margin-top: 10px;">Target: Retensi & Loyalty Program</p>
        </div>

        <div class="card" style="text-align: center;">
            <div style="font-size: 40px; margin-bottom: 10px;">üöó</div>
            <div class="kpi-value text-blue" id="geoSatellite">0%</div>
            <div class="kpi-label">Secondary (Kabupaten)</div>
            <p style="font-size: 12px; margin-top: 10px;">Target: Weekend Getaway</p>
        </div>

        <div class="card" style="text-align: center;">
            <div style="font-size: 40px; margin-bottom: 10px;">‚úàÔ∏è</div>
            <div class="kpi-value text-red" id="geoTourist">0%</div>
            <div class="kpi-label">Tourist (Luar Kota)</div>
            <p style="font-size: 12px; margin-top: 10px;">Target: Seasonal & Holiday Promo</p>
        </div>
    </div>

    <div class="card" style="margin-top: 25px; height: 250px;">
        <h3>Detailed Region Breakdown</h3>
        <div class="chart-box">
            <canvas id="geoChart"></canvas>
        </div>
    </div>
  </div>
</div>

<div class="slide cinematic" style="background-image: url('https://images.unsplash.com/photo-1544148103-0773bf10d330?q=80&w=1920&auto=format&fit=crop');">
  <h1>Execution Matters.</h1>
  <p style="font-size: 24px; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.8);">
    Data sudah berbicara.<br>
    Saatnya mengeksekusi strategi dengan presisi.
  </p>
  <div style="margin-top: 40px; padding: 15px 30px; background: var(--accent-green); color: #000; font-weight: bold; border-radius: 50px;">
    Dolan Sawah 2026
  </div>
</div>


<div class="controls">
  <button class="btn-nav" onclick="prevSlide()">‚óÄ</button>
  <button class="btn-nav" onclick="nextSlide()">‚ñ∂</button>
</div>

<div class="footer-info">
  <div class="footer-brand">DOLAN SAWAH INTELLIGENCE</div>
  <div class="footer-status">
      <div class="dot-pulse" style="width: 6px; height: 6px;"></div>
      <span id="footerConnectionText">Connected to Database</span>
  </div>
</div>


<script>
// 1. KONFIGURASI FIREBASE (DOUBLE INSTANCE)
// Kita menggunakan dua konfigurasi terpisah untuk Reservasi & Member
// agar bisa menarik data dari 2 project firebase berbeda sekaligus.

const configReservasi = {
  apiKey: "AIzaSyA_c1tU70FM84Qi_f_aSaQ-YVLo_18lCkI",
  authDomain: "reservasi-dolan-sawah.firebaseapp.com",
  projectId: "reservasi-dolan-sawah",
  storageBucket: "reservasi-dolan-sawah.appspot.com",
  messagingSenderId: "213151400721",
  appId: "1:213151400721:web:e51b0d8cdd24206cf682b0"
};

const configMember = {
  apiKey: "AIzaSyAEzWDI9ZWlc7NnUTDBbx7wednnUVeS9Ao",
  authDomain: "member-hp-dolansawah.firebaseapp.com",
  projectId: "member-hp-dolansawah",
  storageBucket: "member-hp-dolansawah.appspot.com",
  messagingSenderId: "277683917105",
  appId: "1:277683917105:web:d496ee4547f339e2fee010"
};

// Variabel Global untuk menyimpan instance DB
let dbReservasi, dbMember;

// 2. FUNGSI INISIALISASI SYSTEM
function initSystem() {
    try {
        // Init Reservasi App
        const appRes = firebase.initializeApp(configReservasi, "AppReservasi");
        dbReservasi = appRes.firestore();
        
        // Init Member App
        const appMem = firebase.initializeApp(configMember, "AppMember");
        dbMember = appMem.firestore();

        console.log("Dual Firebase Init Success");
        
        // Jalankan pengambilan data
        fetchDataReservasi();
        fetchDataMember();

    } catch (error) {
        console.error("Critical Error Initialization:", error);
        document.getElementById('mainStatus').innerHTML = "<span style='color:red'>CONNECTION FAILED. RETRYING...</span>";
        setTimeout(initSystem, 3000); // Retry logic
    }
}

// 3. FUNGSI FORMAT MATA UANG (IDR)
const formatIDR = (num) => {
    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num);
}

// 4. LOGIC: FETCH & PROCESS DATA RESERVASI
async function fetchDataReservasi() {
    try {
        const snapshot = await dbReservasi.collection('reservations').get();
        const data = snapshot.docs.map(doc => doc.data());

        // A. Proses Revenue (Omzet)
        processRevenueData(data);
        
        // B. Proses Menu
        processMenuData(data);

        document.getElementById('statusRev').style.display = 'none';

    } catch (err) {
        console.error("Error Fetch Reservasi:", err);
    }
}

// 5. LOGIC: FETCH & PROCESS DATA MEMBER
async function fetchDataMember() {
    try {
        const snapshot = await dbMember.collection('members').get();
        const data = snapshot.docs.map(doc => doc.data());

        // A. Proses Source (Asal Info)
        processMemberSource(data);
        
        // B. Proses Geo (Domisili)
        processMemberGeo(data);
        
        // Update Main Status
        document.getElementById('mainStatus').innerHTML = "<span style='color:#00ff99'>‚óè LIVE DATA STREAM ACTIVE</span>";

    } catch (err) {
        console.error("Error Fetch Member:", err);
    }
}

// 6. PROCESSOR: REVENUE CHART & KPI
function processRevenueData(reservations) {
    const months = ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Ags','Sep','Okt','Nov','Des'];
    const revenuePerMonth = new Array(12).fill(0);
    let totalRevenue = 0;
    let totalCount = 0;

    reservations.forEach(res => {
        if(res.date && res.dp) {
            const dateObj = new Date(res.date);
            const nominal = parseInt(res.dp);
            
            if(!isNaN(dateObj.getTime()) && !isNaN(nominal)) {
                revenuePerMonth[dateObj.getMonth()] += nominal;
                totalRevenue += nominal;
                totalCount++;
            }
        }
    });

    // Update KPI Text
    document.getElementById('kpiTotalRes').innerText = totalCount.toLocaleString('id-ID');
    document.getElementById('kpiTotalRev').innerText = formatIDR(totalRevenue);
    
    // Hitung Average Ticket
    const avgTicket = totalCount > 0 ? totalRevenue / totalCount : 0;
    document.getElementById('kpiAvgTicket').innerText = "Avg. DP: " + formatIDR(avgTicket);

    // Render Chart JS
    const ctx = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Omzet DP',
                data: revenuePerMonth,
                borderColor: '#00ff99',
                backgroundColor: 'rgba(0, 255, 153, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: {display: false} },
            scales: {
                y: { 
                    grid: { color: 'rgba(255,255,255,0.05)' },
                    ticks: { color: '#888', callback: function(value) { return value/1000 + 'k'; } }
                },
                x: { 
                    grid: { display: false },
                    ticks: { color: '#aaa' }
                }
            }
        }
    });
}

// 7. PROCESSOR: MENU RANKING
function processMenuData(reservations) {
    const menuCounter = {};

    reservations.forEach(res => {
        // Handle format array (new system)
        if(Array.isArray(res.menus)) {
            res.menus.forEach(m => {
                const name = m.name || "Unknown";
                const qty = parseInt(m.quantity) || 1;
                menuCounter[name] = (menuCounter[name] || 0) + qty;
            });
        } 
        // Handle format legacy (old system)
        else if (res.menu) {
            menuCounter[res.menu] = (menuCounter[res.menu] || 0) + 1;
        }
    });

    // Sorting & Top 7
    const sortedMenu = Object.entries(menuCounter)
        .sort((a,b) => b[1] - a[1])
        .slice(0, 7);

    // Render List Detail
    const listEl = document.getElementById('menuListDetail');
    listEl.innerHTML = "";
    
    sortedMenu.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
            <span class="rank-index">#${index+1}</span>
            <span class="rank-name">${item[0]}</span>
            <span class="rank-value">${item[1]} <small style="font-weight:400; color:#888;">porsi</small></span>
        `;
        listEl.appendChild(li);
    });

    // Render Chart Horizontal Bar
    const ctx = document.getElementById('menuChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: sortedMenu.map(m => m[0].substring(0, 15) + '...'),
            datasets: [{
                label: 'Porsi Terjual',
                data: sortedMenu.map(m => m[1]),
                backgroundColor: '#33ccff',
                borderRadius: 5
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: {display: false} },
            scales: {
                x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888' } },
                y: { grid: { display: false }, ticks: { color: '#fff', font: {size: 11} } }
            }
        }
    });
}

// 8. PROCESSOR: MEMBER SOURCE (DONUT CHART)
function processMemberSource(members) {
    document.getElementById('kpiTotalMember').innerText = members.length;

    // Hitung Verified
    const verifiedCount = members.filter(m => m.isVerified).length;
    const verifiedPct = members.length > 0 ? Math.round((verifiedCount / members.length) * 100) : 0;
    
    document.getElementById('barVerified').style.width = verifiedPct + "%";
    document.getElementById('txtVerified').innerText = verifiedPct + "%";

    // Hitung Source
    const sources = {};
    members.forEach(m => {
        let src = (m.sumberInfo || "Lainnya").toLowerCase();
        
        // Grouping Data yang mirip
        if(src.includes('ig') || src.includes('instagram')) src = 'Instagram';
        else if(src.includes('tiktok')) src = 'TikTok';
        else if(src.includes('google') || src.includes('maps')) src = 'Google Maps';
        else if(src.includes('teman') || src.includes('saudara')) src = 'Word of Mouth';
        else src = 'Lainnya';
        
        sources[src] = (sources[src] || 0) + 1;
    });

    const ctx = document.getElementById('sourceChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(sources),
            datasets: [{
                data: Object.values(sources),
                backgroundColor: ['#E1306C', '#000000', '#4285F4', '#00ff99', '#888'],
                borderColor: '#222',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right', labels: { color: '#fff', font: {size: 11} } }
            },
            cutout: '60%'
        }
    });
}

// 9. PROCESSOR: GEO LOCATION
function processMemberGeo(members) {
    const geo = {
        'Semarang': 0,
        'Kab. Semarang': 0,
        'Luar Kota': 0
    };

    members.forEach(m => {
        const addr = (m.alamat || "").toLowerCase();
        if(addr.includes('semarang') && !addr.includes('kab')) geo['Semarang']++;
        else if(addr.includes('kab') && addr.includes('semarang')) geo['Kab. Semarang']++;
        else geo['Luar Kota']++;
    });

    // Hitung Persentase untuk KPI Cards
    const total = members.length || 1;
    document.getElementById('geoSemarang').innerText = Math.round((geo['Semarang']/total)*100) + "%";
    document.getElementById('geoSatellite').innerText = Math.round((geo['Kab. Semarang']/total)*100) + "%";
    document.getElementById('geoTourist').innerText = Math.round((geo['Luar Kota']/total)*100) + "%";

    // Render Geo Chart
    const ctx = document.getElementById('geoChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Kota Semarang', 'Kab. Semarang', 'Luar Kota/Tourist'],
            datasets: [{
                label: 'Jumlah Member',
                data: [geo['Semarang'], geo['Kab. Semarang'], geo['Luar Kota']],
                backgroundColor: ['#00ff99', '#33ccff', '#ff0050'],
                borderRadius: 8,
                barThickness: 50
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: {display: false} },
            scales: {
                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888' } },
                x: { grid: { display: false }, ticks: { color: '#fff' } }
            }
        }
    });
}


// ==========================================================================
// CONTROL LOGIC (SLIDESHOW)
// ==========================================================================
let currentSlide = 0;
const slides = document.querySelectorAll('.slide');

function showSlide(n) {
    slides.forEach(s => {
        s.classList.remove('active');
        s.style.display = 'none'; // Ensure fully hidden
    });
    
    // Wrap around index
    currentSlide = (n + slides.length) % slides.length;
    
    slides[currentSlide].style.display = 'flex';
    // Sedikit delay untuk memicu animasi CSS
    setTimeout(() => {
        slides[currentSlide].classList.add('active');
    }, 10);
}

function nextSlide() { showSlide(currentSlide + 1); }
function prevSlide() { showSlide(currentSlide - 1); }

// Keyboard Support
document.addEventListener('keydown', (e) => {
    if(e.key === "ArrowRight" || e.key === " " || e.key === "Enter") nextSlide();
    if(e.key === "ArrowLeft") prevSlide();
});

// Start System
initSystem();

</script>
</body>
</html>
