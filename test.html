<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dolan Sawah ‚Äî Strategic Marketing & Real-Time Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<style>
/* =========================================
   STYLE ASLI PRESENTASI (TIDAK ADA YANG DIHAPUS)
   ========================================= */
:root{
  --bg:#000;
  --fg:#fff;
  --accent:#00ff99;
  --info:#33ccff; /* Tambahan warna untuk chart */
  --muted:rgba(255,255,255,.45);
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--fg);
  overflow:hidden;
}

.slide{
  display:none;
  min-height:100vh;
  padding:clamp(28px,7vw,96px);
  text-align:center;
  align-items:center;
  justify-content:center;
  width: 100vw;
}

.slide.active{
  display:flex;
  flex-direction:column;
  animation:fade .6s ease;
}

h1{font-size:clamp(38px,7vw,72px);margin-bottom:22px}
h2{font-size:clamp(26px,5vw,48px);margin-bottom:20px}
h3{font-size:clamp(20px,4vw,32px);margin-bottom:16px; color:var(--accent)}

p{
  font-size:clamp(16px,3vw,26px);
  max-width:980px;
  line-height:1.55;
  color:var(--muted);
}

.highlight{color:var(--accent);font-weight:600}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:26px;
  width:100%;
  max-width: 1200px;
  margin-top:36px;
}

.card{
  border:1px solid rgba(255,255,255,.15);
  border-radius:20px;
  padding:30px;
  background: rgba(255,255,255,0.02);
}

.bar{
  height:10px;
  background:rgba(255,255,255,.15);
  border-radius:6px;
  margin-top:14px;
  overflow:hidden;
}

.fill{
  height:100%;
  width:0;
  background:var(--accent);
  animation:grow 1.2s ease forwards;
}

.controls{
  position:fixed;
  bottom:22px;
  right:22px;
  display:flex;
  gap:10px;
  z-index: 100;
}

button{
  background:rgba(255,255,255,.1);
  border:1px solid rgba(255,255,255,.2);
  color:#fff;
  padding:12px 18px;
  border-radius:28px;
  cursor:pointer;
}

button:hover{background:var(--accent);color:#000}

.footer{
  position:fixed;
  bottom:22px;
  left:22px;
  font-size:12px;
  opacity:.35;
}

/* Cinematic */
.cinematic{
  background-size:cover;
  background-position:center;
  position:relative;
}
.cinematic::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.6);
}
.cinematic>*{position:relative;z-index:2}

@keyframes fade{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:none}
}
@keyframes grow{to{width:var(--w)}}

/* =========================================
   STYLE TAMBAHAN UNTUK DATA REAL-TIME
   ========================================= */
.chart-wrapper {
  position: relative;
  width: 100%;
  height: 250px;
}
.loading-indicator {
    color: var(--accent);
    font-size: 0.9em;
    margin-top: 10px;
    display: none;
    font-style: italic;
}
.loading-indicator.visible { display: block; }

/* Styling List Menu Real */
ul.insight-list {
  text-align: left;
  list-style: none;
  padding: 0;
  margin-top: 10px;
  max-height: 300px;
  overflow-y: auto;
}
ul.insight-list li {
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  font-size: 0.9em;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
ul.insight-list li:last-child { border-bottom: none; }

ul.insight-list li .menu-meta {
    display: flex;
    flex-direction: column;
    max-width: 80%;
}
ul.insight-list li .menu-name { 
    font-weight: 700; 
    color: #fff; 
    font-size: 1em; 
}
ul.insight-list li .menu-desc { 
    font-size: 0.8em; 
    color: var(--muted); 
    margin-top: 4px; 
    font-style: italic;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
ul.insight-list li .menu-qty { 
    font-weight: 700; 
    color: var(--accent); 
    font-size: 1.2em; 
}
</style>
</head>

<body>

<div class="slide active">
  <h1>Dolan Sawah</h1>
  <p>Strategic Marketing & Competitive Playbook</p>
  <p id="connectionStatus" style="font-size: 12px; margin-top: 20px; color: var(--muted); opacity: 0.7;">
    System Status: Menghubungkan ke Database...
  </p>
</div>

<div class="slide">
  <h2>Masalah Nyata</h2>
  <p>
    Liburan selesai.<br>
    Trafik menurun.<br>
    <span class="highlight">Ini bukan kegagalan.</span>
  </p>
</div>

<div class="slide">
  <h2>Ini Pola Industri</h2>
  <p>
    Semua resto wisata mengalaminya.<br>
    Yang bertahan bukan yang viral,<br>
    tapi yang <span class="highlight">relevan.</span>
  </p>
</div>

<div class="slide">
  <h1>Warung Kinasih</h1>
  <p>Dekat secara lokasi.<br>Berbeda secara model bisnis.</p>
</div>

<div class="slide">
  <h2>Kenapa Mereka Viral?</h2>
  <div class="grid">
    <div class="card">
      Harga mudah diviralkan
      <div class="bar"><div class="fill" style="--w:90%"></div></div>
    </div>
    <div class="card">
      Visual instan
      <div class="bar"><div class="fill" style="--w:85%"></div></div>
    </div>
    <div class="card">
      Konten mudah ditiru
      <div class="bar"><div class="fill" style="--w:95%"></div></div>
    </div>
  </div>
</div>

<div class="slide">
  <h2>Insight Kritis</h2>
  <p>
    Mereka menjual <span class="highlight">sensasi pertama</span>,<br>
    bukan pengalaman berulang.
  </p>
</div>

<div class="slide">
  <h2>Dampak ke Area</h2>
  <p>
    Orang datang.<br>
    Antre.<br>
    Lelah.<br>
    Mulai mencari <span class="highlight">alternatif.</span>
  </p>
</div>

<div class="slide">
  <h2>Perbandingan Jujur</h2>
  <div class="grid">
    <div class="card">
      <b>Kinasih</b><br><br>
      Cepat<br>Padat<br>FOMO<br>Sekali datang
    </div>
    <div class="card">
      <b class="highlight">Dolan Sawah</b><br><br>
      Luas<br>Santai<br>Experience<br>Repeat tinggi
    </div>
  </div>
</div>

<div class="slide">
  <h2>Kesalahan Umum</h2>
  <p>
    Meniru viral.<br>
    Padahal kita menang di <span class="highlight">kenyamanan.</span>
  </p>
</div>

<div class="slide">
  <h1>Positioning Baru</h1>
  <p class="highlight">‚ÄúTempat kembali setelah resto viral.‚Äù</p>
</div>

<div class="slide">
  <h2>Maknanya</h2>
  <p>
    Kita tidak melawan kompetitor.<br>
    Kita <span class="highlight">melengkapi perjalanan pelanggan.</span>
  </p>
</div>

<div class="slide">
  <h1>Strategi Marketing</h1>
  <p>Bukan ramai.<br>Tapi <span class="highlight">relevan di momen tepat.</span></p>
</div>

<div class="slide">
  <h2>Pilar Strategi</h2>
  <div class="grid">
    <div class="card">Visibility<br><span class="highlight">Mudah ditemukan</span></div>
    <div class="card">Contrast<br><span class="highlight">Jelas berbeda</span></div>
    <div class="card">Convenience<br><span class="highlight">Tanpa friksi</span></div>
    <div class="card">Repeat Value<br><span class="highlight">Layak kembali</span></div>
  </div>
</div>

<div class="slide">
  <h2>Taktik Utama</h2>
  <p>
    Saat kompetitor menciptakan keramaian,<br>
    kita menciptakan <span class="highlight">jalan keluar.</span>
  </p>
</div>

<div class="slide">
  <h1>Eksekusi 30 Hari</h1>
  <p>Strategi ini harus terasa<br><span class="highlight">dalam 4 minggu.</span></p>
</div>

<div class="slide">
  <h2>Minggu 1 ‚Äî Visibility & Trust</h2>
  <p>‚Ä¢ Update Google Business<br>‚Ä¢ Konten area luas & view<br>‚Ä¢ Tone: tenang & keluarga</p>
</div>

<div class="slide">
  <h2>Minggu 2 ‚Äî Contrast & Capture</h2>
  <p>‚Ä¢ Konten kontras (ramai vs lapang)<br>‚Ä¢ Geo ads sekitar kompetitor<br>‚Ä¢ CTA: tanpa antre</p>
</div>

<div class="slide">
  <h2>Minggu 3 ‚Äî Value & Repeat</h2>
  <p>‚Ä¢ Paket keluarga / menu hero<br>‚Ä¢ Promo weekday ringan<br>‚Ä¢ Dorong review Google</p>
</div>

<div class="slide">
  <h2>Minggu 4 ‚Äî Optimize & Scale</h2>
  <p>‚Ä¢ Matikan konten gagal<br>‚Ä¢ Gandakan konten perform<br>‚Ä¢ Kunci SOP konten</p>
</div>

<div class="slide">
  <h1>KPI Marketing</h1>
  <p>Tanpa data,<br>strategi hanya opini.</p>
</div>

<div class="slide">
  <h2>KPI Utama</h2>
  <div class="grid">
    <div class="card">Traffic Weekday<div class="bar"><div class="fill" style="--w:70%"></div></div></div>
    <div class="card">Avg Transaction<div class="bar"><div class="fill" style="--w:60%"></div></div></div>
    <div class="card">Repeat Customer<div class="bar"><div class="fill" style="--w:55%"></div></div></div>
    <div class="card">Google Rating<div class="bar"><div class="fill" style="--w:85%"></div></div></div>
  </div>
</div>

<div class="slide">
  <h2>Operational Intelligence</h2>
  <p style="font-size: 16px; margin-bottom: 20px;">Data Real-Time dari <span class="highlight">Sistem Reservasi & Firebase</span>.</p>
  
  <div class="grid" style="grid-template-columns: 2fr 1fr; margin-top: 15px; align-items: start; gap: 20px;">
    
    <div class="card" style="padding: 20px;">
        <h3 style="font-size: 16px; text-align: left; margin-bottom: 10px;">Tren Omzet DP (YTD)</h3>
        <div class="chart-wrapper" style="height: 220px;">
            <canvas id="revenueChart"></canvas>
        </div>
        <div id="loadingRevenue" class="loading-indicator visible">Sedang menghitung omzet...</div>
    </div>

    <div class="card" style="padding: 20px; text-align: left; height: 100%;">
        <h3 style="font-size: 16px; margin-bottom: 10px; color: var(--accent);">üî• Menu Terlaris</h3>
        <div id="loadingMenu" class="loading-indicator visible">Menganalisis pesanan...</div>
        <ul class="insight-list" id="topMenuList">
            </ul>
    </div>

  </div>
</div>

<div class="slide">
  <h1>Brand Manifesto</h1>
  <p>Kami tidak mengejar viral.</p>
</div>

<div class="slide">
  <p>
    Kami percaya makan adalah pengalaman.<br><br>
    Ruang untuk keluarga.<br>
    Waktu untuk berbincang.<br>
    Tempat untuk kembali.
  </p>
</div>

<div class="slide cinematic" style="background-image:url('https://images.unsplash.com/photo-1528605248644-14dd04022da1')">
  <h1>Dolan Sawah</h1>
  <p>Lebih dari sekadar makan.</p>
</div>

<div class="slide cinematic" style="background-image:url('https://images.unsplash.com/photo-1504674900247-0877df9cc836')">
  <h1>Penutup</h1>
  <p><span class="highlight">Viral lewat. Experience tinggal.</span></p>
</div>

<div class="controls">
  <button onclick="prev()">‚óÄ</button>
  <button onclick="next()">‚ñ∂</button>
</div>

<div class="footer">Dolan Sawah ‚Äî Strategic Marketing</div>

<script>
// =========================================
// 1. FIREBASE CONFIG (DARI KODE RESERVASI ANDA)
// =========================================
const firebaseConfig = {
  apiKey: "AIzaSyA_c1tU70FM84Qi_f_aSaQ-YVLo_18lCkI",
  authDomain: "reservasi-dolan-sawah.firebaseapp.com",
  projectId: "reservasi-dolan-sawah",
  storageBucket: "reservasi-dolan-sawah.appspot.com",
  messagingSenderId: "213151400721",
  appId: "1:213151400721:web:e51b0d8cdd24206cf682b0"
};

// Initialize Firebase
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.firestore();

// =========================================
// 2. NAVIGASI SLIDE (ASLI)
// =========================================
let slides=document.querySelectorAll('.slide');
let i=0;
function show(n){
  slides.forEach(s=>s.classList.remove('active'));
  slides[n].classList.add('active');
}
function next(){i=(i+1)%slides.length;show(i)}
function prev(){i=(i-1+slides.length)%slides.length;show(i)}
document.addEventListener('keydown',e=>{
  if(e.key==="ArrowRight"||e.key===" ")next();
  if(e.key==="ArrowLeft")prev();
});

// =========================================
// 3. LOGIKA FETCH DATA REAL-TIME
// =========================================

// Variabel Global Data
let allReservations = [];
let menuDetails = {}; // Menyimpan detail isian dari collection 'menus'

// A. Fungsi Utama: Load Data saat halaman dibuka
async function loadRealData() {
    const statusEl = document.getElementById('connectionStatus');
    try {
        // 1. Ambil Data Menu (untuk dapat detail isian real)
        statusEl.textContent = "Mengambil database menu...";
        const menuSnapshot = await db.collection('menus').get();
        menuSnapshot.forEach(doc => {
            // Simpan detail isian (array) ke object dictionary
            menuDetails[doc.id] = doc.data().details || []; 
        });

        // 2. Ambil Data Reservasi
        statusEl.textContent = "Mengambil riwayat transaksi...";
        const resSnapshot = await db.collection('reservations').get();
        
        allReservations = resSnapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
        }));

        statusEl.textContent = `Terkoneksi. ${allReservations.length} data reservasi dimuat.`;
        statusEl.style.color = '#00ff99';

        // 3. Jalankan Pengolahan Data
        processTopMenuData();
        processRevenueData();

    } catch (error) {
        console.error("Error fetching data:", error);
        statusEl.textContent = "Gagal koneksi database: " + error.message;
        statusEl.style.color = 'red';
    }
}

// B. Proses Data: Menu Terlaris & Isiannya
function processTopMenuData() {
    const menuCounts = {};

    // Loop semua reservasi
    allReservations.forEach(res => {
        if (Array.isArray(res.menus)) {
            // Format Baru (Array)
            res.menus.forEach(item => {
                const name = item.name;
                const qty = parseInt(item.quantity) || 0;
                menuCounts[name] = (menuCounts[name] || 0) + qty;
            });
        } else if (res.menu) {
            // Format Lama (String)
            const name = res.menu;
            menuCounts[name] = (menuCounts[name] || 0) + 1;
        }
    });

    // Urutkan (Terbanyak ke Terkecil)
    const sortedMenus = Object.entries(menuCounts)
        .sort((a, b) => b[1] - a[1]) 
        .slice(0, 5); // Ambil 5 Besar

    // Render ke HTML
    const listEl = document.getElementById('topMenuList');
    listEl.innerHTML = ''; 
    document.getElementById('loadingMenu').style.display = 'none';

    if (sortedMenus.length === 0) {
        listEl.innerHTML = '<li>Belum ada data pesanan.</li>';
        return;
    }

    sortedMenus.forEach(([name, count], index) => {
        // Ambil detail isian yang nyata dari database 'menus'
        let detailString = 'Menu Spesial';
        if (menuDetails[name] && menuDetails[name].length > 0) {
            // Gabungkan array isian jadi string (contoh: "Nasi, Ayam, Telur")
            detailString = menuDetails[name].join(', ');
        }
        
        const li = document.createElement('li');
        li.innerHTML = `
            <div class="menu-meta">
                <span class="menu-name">#${index + 1} ${name}</span>
                <span class="menu-desc">${detailString}</span>
            </div>
            <span class="menu-qty">${count}</span>
        `;
        listEl.appendChild(li);
    });
}

// C. Proses Data: Grafik Omzet DP Bulanan
function processRevenueData() {
    const monthlyRevenue = new Array(12).fill(0); // [0,0,0...] untuk Jan-Des
    const monthLabels = ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Ags", "Sep", "Okt", "Nov", "Des"];

    allReservations.forEach(res => {
        if (res.date && res.dp) {
            const date = new Date(res.date);
            if (!isNaN(date.getTime())) {
                const monthIndex = date.getMonth(); // 0 = Jan
                monthlyRevenue[monthIndex] += parseInt(res.dp);
            }
        }
    });

    // Render Chart
    document.getElementById('loadingRevenue').style.display = 'none';
    const ctx = document.getElementById('revenueChart').getContext('2d');
    
    // Config Warna Dark Mode
    Chart.defaults.color = 'rgba(255,255,255,0.7)';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: monthLabels,
            datasets: [{
                label: 'Total DP Masuk (Rp)',
                data: monthlyRevenue,
                borderColor: '#00ff99', // Hijau Neon
                backgroundColor: 'rgba(0, 255, 153, 0.1)',
                borderWidth: 3,
                tension: 0.3,
                fill: true,
                pointBackgroundColor: '#fff',
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return 'Rp ' + context.parsed.y.toLocaleString('id-ID');
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255,255,255,0.1)' },
                    ticks: {
                        callback: function(value) {
                            return (value / 1000) + 'k'; // Format ribuan
                        }
                    }
                },
                x: { grid: { display: false } }
            }
        }
    });
}

// Jalankan saat load
loadRealData();

</script>

</body>
</html>
