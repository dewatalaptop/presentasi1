<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dolan Sawah ‚Äî Strategic Marketing & Real-Time Data Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<style>
/* =========================================
   STYLE ASLI (ORIGINAL CSS - UNTOUCHED)
   ========================================= */
:root{
  --bg:#000;
  --fg:#fff;
  --accent:#00ff99;
  --muted:rgba(255,255,255,.45);
  /* Tambahan variabel untuk chart */
  --info: #33ccff;
  --tiktok: #ff0050;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--fg);
  overflow:hidden;
}

.slide{
  display:none;
  min-height:100vh;
  padding:clamp(28px,7vw,96px);
  text-align:center;
  align-items:center;
  justify-content:center;
  width: 100vw; /* Memastikan lebar penuh */
}

.slide.active{
  display:flex;
  flex-direction:column;
  animation:fade .6s ease;
}

h1{font-size:clamp(38px,7vw,72px);margin-bottom:22px}
h2{font-size:clamp(26px,5vw,48px);margin-bottom:20px}
h3{font-size:clamp(20px,4vw,32px);margin-bottom:16px}

p{
  font-size:clamp(16px,3vw,26px);
  max-width:980px;
  line-height:1.55;
  color:var(--muted);
}

.highlight{color:var(--accent);font-weight:600}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:26px;
  width:100%;
  max-width: 1200px; /* Menjaga agar konten tidak terlalu lebar di layar besar */
  margin-top:36px;
}

.card{
  border:1px solid rgba(255,255,255,.15);
  border-radius:20px;
  padding:30px;
  /* Tambahan background tipis agar chart lebih terbaca */
  background: rgba(255,255,255,0.02);
}

.bar{
  height:10px;
  background:rgba(255,255,255,.15);
  border-radius:6px;
  margin-top:14px;
  overflow:hidden;
}

.fill{
  height:100%;
  width:0;
  background:var(--accent);
  animation:grow 1.2s ease forwards;
}

.controls{
  position:fixed;
  bottom:22px;
  right:22px;
  display:flex;
  gap:10px;
  z-index: 100;
}

button{
  background:rgba(255,255,255,.1);
  border:1px solid rgba(255,255,255,.2);
  color:#fff;
  padding:12px 18px;
  border-radius:28px;
  cursor:pointer;
}

button:hover{background:var(--accent);color:#000}

.footer{
  position:fixed;
  bottom:22px;
  left:22px;
  font-size:12px;
  opacity:.35;
}

/* Cinematic */
.cinematic{
  background-size:cover;
  background-position:center;
  position:relative;
}
.cinematic::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.6);
}
.cinematic>*{position:relative;z-index:2}

@keyframes fade{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:none}
}
@keyframes grow{to{width:var(--w)}}

/* =========================================
   STYLE TAMBAHAN (DATA VISUALIZATION)
   ========================================= */
.chart-wrapper {
  position: relative;
  width: 100%;
  height: 220px; /* Tinggi grafik disesuaikan */
}

/* Typography untuk Big Numbers */
.stat-big {
  font-size: 3rem;
  font-weight: 700;
  color: var(--accent);
  line-height: 1;
  margin-bottom: 5px;
}
.stat-label {
  font-size: 0.9rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Indikator Loading Data */
.loading-indicator {
    color: var(--accent);
    font-size: 0.8em;
    margin-top: 10px;
    display: none;
    font-style: italic;
    animation: blink 1.5s infinite;
}
.loading-indicator.visible { display: block; }
@keyframes blink { 50% { opacity: 0.5; } }

/* Custom List untuk Menu Real-Time */
ul.insight-list {
  text-align: left;
  list-style: none;
  padding: 0;
  margin-top: 10px;
  max-height: 280px;
  overflow-y: auto;
}
ul.insight-list li {
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  font-size: 0.9em;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
ul.insight-list li:last-child { border-bottom: none; }

ul.insight-list li .menu-meta { 
    display: flex; 
    flex-direction: column; 
    max-width: 80%; 
}
ul.insight-list li .menu-name { 
    font-weight: 700; 
    color: #fff; 
    font-size: 1em; 
}
ul.insight-list li .menu-desc { 
    font-size: 0.8em; 
    color: var(--muted); 
    margin-top: 4px; 
    font-style: italic; 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
}
ul.insight-list li .menu-qty { 
    font-weight: 700; 
    color: var(--accent); 
    font-size: 1.2em; 
}
</style>
</head>

<body>

<div class="slide active">
  <h1>Dolan Sawah</h1>
  <p>Strategic Marketing & Competitive Playbook</p>
  <div id="connectionStatus" style="font-size: 12px; margin-top: 20px; color: var(--muted); border:1px solid #333; padding:5px 15px; border-radius:20px; display:inline-block;">
    Connecting to Reservasi & Member Database...
  </div>
</div>

<div class="slide">
  <h2>Masalah Nyata</h2>
  <p>
    Liburan selesai.<br>
    Trafik menurun.<br>
    <span class="highlight">Ini bukan kegagalan.</span>
  </p>
</div>

<div class="slide">
  <h2>Ini Pola Industri</h2>
  <p>
    Semua resto wisata mengalaminya.<br>
    Yang bertahan bukan yang viral,<br>
    tapi yang <span class="highlight">relevan.</span>
  </p>
</div>

<div class="slide">
  <h1>Warung Kinasih</h1>
  <p>Dekat secara lokasi.<br>Berbeda secara model bisnis.</p>
</div>

<div class="slide">
  <h2>Kenapa Mereka Viral?</h2>
  <div class="grid">
    <div class="card">
      Harga mudah diviralkan
      <div class="bar"><div class="fill" style="--w:90%"></div></div>
    </div>
    <div class="card">
      Visual instan
      <div class="bar"><div class="fill" style="--w:85%"></div></div>
    </div>
    <div class="card">
      Konten mudah ditiru
      <div class="bar"><div class="fill" style="--w:95%"></div></div>
    </div>
  </div>
</div>

<div class="slide">
  <h2>Insight Kritis</h2>
  <p>
    Mereka menjual <span class="highlight">sensasi pertama</span>,<br>
    bukan pengalaman berulang.
  </p>
</div>

<div class="slide">
  <h2>Dampak ke Area</h2>
  <p>
    Orang datang.<br>
    Antre.<br>
    Lelah.<br>
    Mulai mencari <span class="highlight">alternatif.</span>
  </p>
</div>

<div class="slide">
  <h2>Perbandingan Jujur</h2>
  <div class="grid">
    <div class="card">
      <b>Kinasih</b><br><br>
      Cepat<br>
      Padat<br>
      FOMO<br>
      Sekali datang
    </div>
    <div class="card">
      <b class="highlight">Dolan Sawah</b><br><br>
      Luas<br>
      Santai<br>
      Experience<br>
      Repeat tinggi
    </div>
  </div>
</div>

<div class="slide">
  <h2>Kesalahan Umum</h2>
  <p>
    Meniru viral.<br>
    Padahal kita menang di <span class="highlight">kenyamanan.</span>
  </p>
</div>

<div class="slide">
  <h1>Positioning Baru</h1>
  <p class="highlight">‚ÄúTempat kembali setelah resto viral.‚Äù</p>
</div>

<div class="slide">
  <h2>Maknanya</h2>
  <p>
    Kita tidak melawan kompetitor.<br>
    Kita <span class="highlight">melengkapi perjalanan pelanggan.</span>
  </p>
</div>

<div class="slide">
  <h1>Strategi Marketing</h1>
  <p>Bukan ramai.<br>Tapi <span class="highlight">relevan di momen tepat.</span></p>
</div>

<div class="slide">
  <h2>Pilar Strategi</h2>
  <div class="grid">
    <div class="card">Visibility<br><span class="highlight">Mudah ditemukan</span></div>
    <div class="card">Contrast<br><span class="highlight">Jelas berbeda</span></div>
    <div class="card">Convenience<br><span class="highlight">Tanpa friksi</span></div>
    <div class="card">Repeat Value<br><span class="highlight">Layak kembali</span></div>
  </div>
</div>

<div class="slide">
  <h2>Taktik Utama</h2>
  <p>
    Saat kompetitor menciptakan keramaian,<br>
    kita menciptakan <span class="highlight">jalan keluar.</span>
  </p>
</div>

<div class="slide">
  <h1>Eksekusi 30 Hari</h1>
  <p>Strategi ini harus terasa<br><span class="highlight">dalam 4 minggu.</span></p>
</div>

<div class="slide">
  <h2>Minggu 1 ‚Äî Visibility & Trust</h2>
  <p>
    ‚Ä¢ Update Google Business<br>
    ‚Ä¢ Konten area luas & view<br>
    ‚Ä¢ Tone: tenang & keluarga
  </p>
</div>

<div class="slide">
  <h2>Minggu 2 ‚Äî Contrast & Capture</h2>
  <p>
    ‚Ä¢ Konten kontras (ramai vs lapang)<br>
    ‚Ä¢ Geo ads sekitar kompetitor<br>
    ‚Ä¢ CTA: tanpa antre
  </p>
</div>

<div class="slide">
  <h2>Minggu 3 ‚Äî Value & Repeat</h2>
  <p>
    ‚Ä¢ Paket keluarga / menu hero<br>
    ‚Ä¢ Promo weekday ringan<br>
    ‚Ä¢ Dorong review Google
  </p>
</div>

<div class="slide">
  <h2>Minggu 4 ‚Äî Optimize & Scale</h2>
  <p>
    ‚Ä¢ Matikan konten gagal<br>
    ‚Ä¢ Gandakan konten perform<br>
    ‚Ä¢ Kunci SOP konten
  </p>
</div>

<div class="slide">
  <h1>KPI Marketing</h1>
  <p>Tanpa data,<br>strategi hanya opini.</p>
</div>

<div class="slide">
  <h2>KPI Utama</h2>
  <div class="grid">
    <div class="card">Traffic Weekday<div class="bar"><div class="fill" style="--w:70%"></div></div></div>
    <div class="card">Avg Transaction<div class="bar"><div class="fill" style="--w:60%"></div></div></div>
    <div class="card">Repeat Customer<div class="bar"><div class="fill" style="--w:55%"></div></div></div>
    <div class="card">Google Rating<div class="bar"><div class="fill" style="--w:85%"></div></div></div>
  </div>
</div>

<div class="slide">
  <h2>Operational Intelligence</h2>
  <p>Data Real-Time dari <span class="highlight">Sistem Reservasi</span>.</p>
  
  <div class="grid" style="grid-template-columns: 2fr 1fr; margin-top: 15px; align-items: start; gap: 20px;">
    <div class="card" style="padding: 20px;">
        <h3 style="font-size: 16px; text-align: left; margin-bottom: 10px;">Tren Omzet DP (YTD)</h3>
        <div class="chart-wrapper">
            <canvas id="revenueChart"></canvas>
        </div>
        <div id="loadingRevenue" class="loading-indicator visible">Mengambil data transaksi...</div>
    </div>

    <div class="card" style="padding: 20px; text-align: left; height: 100%;">
        <h3 style="font-size: 16px; margin-bottom: 10px; color: var(--accent);">üî• Menu Terlaris</h3>
        <div id="loadingMenu" class="loading-indicator visible">Menganalisis pesanan...</div>
        <ul class="insight-list" id="topMenuList">
            </ul>
    </div>
  </div>
</div>

<div class="slide">
  <h2>Member Growth Engine</h2>
  <p>Analisis Loyalitas dari <span class="highlight" style="color:var(--info)">Sistem Member</span>.</p>
  
  <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top: 20px; gap: 25px; align-items: start;">
    
    <div style="display:flex; flex-direction:column; gap:20px;">
      <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top: 0; gap: 15px;">
          <div class="card" style="padding:15px;">
            <div class="stat-big" id="totalMemberCount">0</div>
            <div class="stat-label">Total Member</div>
          </div>
          <div class="card" style="padding:15px;">
            <div class="stat-big" style="color:var(--info)" id="verifiedMemberCount">0%</div>
            <div class="stat-label">Verified WA</div>
          </div>
      </div>
      
      <div class="card" style="text-align:left; padding:20px;">
          <h3 style="font-size:16px; margin-bottom:10px; color:var(--info)">üìç Top Domisili Member</h3>
          <ul class="insight-list" id="addressList" style="max-height: 150px;">
              </ul>
      </div>
    </div>

    <div class="card" style="height: 100%; display:flex; flex-direction:column; justify-content:center; padding:20px;">
        <h3 style="font-size:16px; margin-bottom:15px;">Sumber Akuisisi Member</h3>
        <div class="chart-wrapper" style="height: 200px;">
            <canvas id="memberSourceChart"></canvas>
        </div>
        <div id="loadingMember" class="loading-indicator visible">Sinkronisasi data member...</div>
    </div>

  </div>
</div>

<div class="slide">
  <h1>Brand Manifesto</h1>
  <p>Kami tidak mengejar viral.</p>
</div>

<div class="slide">
  <p>
    Kami percaya makan adalah pengalaman.<br><br>
    Ruang untuk keluarga.<br>
    Waktu untuk berbincang.<br>
    Tempat untuk kembali.
  </p>
</div>

<div class="slide cinematic" style="background-image:url('https://images.unsplash.com/photo-1528605248644-14dd04022da1')">
  <h1>Dolan Sawah</h1>
  <p>Lebih dari sekadar makan.</p>
</div>

<div class="slide cinematic" style="background-image:url('https://images.unsplash.com/photo-1504674900247-0877df9cc836')">
  <h1>Penutup</h1>
  <p><span class="highlight">Viral lewat. Experience tinggal.</span></p>
</div>

<div class="controls">
  <button onclick="prev()">‚óÄ</button>
  <button onclick="next()">‚ñ∂</button>
</div>

<div class="footer">Dolan Sawah ‚Äî Integrated Data System</div>

<script>
// =========================================
// 1. CONFIG: DUAL DATABASE FIREBASE
// =========================================

// CONFIG A: RESERVASI (Untuk Menu & Omzet)
const configReservasi = {
  apiKey: "AIzaSyA_c1tU70FM84Qi_f_aSaQ-YVLo_18lCkI",
  authDomain: "reservasi-dolan-sawah.firebaseapp.com",
  projectId: "reservasi-dolan-sawah",
  storageBucket: "reservasi-dolan-sawah.appspot.com",
  messagingSenderId: "213151400721",
  appId: "1:213151400721:web:e51b0d8cdd24206cf682b0"
};

// CONFIG B: MEMBER (Untuk Member Count, Alamat, Source)
const configMember = {
  apiKey: "AIzaSyAEzWDI9ZWlc7NnUTDBbx7wednnUVeS9Ao",
  authDomain: "member-hp-dolansawah.firebaseapp.com",
  projectId: "member-hp-dolansawah",
  storageBucket: "member-hp-dolansawah.appspot.com",
  messagingSenderId: "277683917105",
  appId: "1:277683917105:web:d496ee4547f339e2fee010"
};

// INITIALIZE DUAL APPS
let appReservasi, appMember;
let dbReservasi, dbMember;

try {
    // Inisialisasi dengan nama app unik agar tidak konflik
    appReservasi = firebase.initializeApp(configReservasi, "AppReservasi");
    appMember = firebase.initializeApp(configMember, "AppMember");
    
    dbReservasi = appReservasi.firestore();
    dbMember = appMember.firestore();
    
    console.log("Dual Firebase Connection Established.");
} catch (e) {
    console.error("Firebase Initialization Error:", e);
    document.getElementById('connectionStatus').innerText = "Connection Failed!";
    document.getElementById('connectionStatus').style.color = "red";
}

// =========================================
// 2. NAVIGASI SLIDE (LOGIC ASLI)
// =========================================
let slides = document.querySelectorAll('.slide');
let i = 0;
function show(n){
  slides.forEach(s=>s.classList.remove('active'));
  slides[n].classList.add('active');
}
function next(){i=(i+1)%slides.length;show(i)}
function prev(){i=(i-1+slides.length)%slides.length;show(i)}
document.addEventListener('keydown',e=>{
  if(e.key==="ArrowRight"||e.key===" ")next();
  if(e.key==="ArrowLeft")prev();
});

// =========================================
// 3. LOGIKA FETCH DATA (REAL-TIME)
// =========================================

async function fetchAllData() {
    const statusEl = document.getElementById('connectionStatus');
    
    try {
        // --- STEP 1: DATA RESERVASI (Menu & Omzet) ---
        statusEl.innerText = "Fetching Reservation Data...";
        
        // Ambil Data Menu (untuk isian detail)
        const menuSnap = await dbReservasi.collection('menus').get();
        const menuDetails = {};
        menuSnap.forEach(doc => {
            menuDetails[doc.id] = doc.data().details || []; 
        });

        // Ambil Data Reservasi
        const resSnap = await dbReservasi.collection('reservations').get();
        const reservations = resSnap.docs.map(doc => doc.data());

        // Proses Data Reservasi
        processReservations(reservations, menuDetails);


        // --- STEP 2: DATA MEMBER (Jumlah, Source, Alamat) ---
        statusEl.innerText = "Fetching Member Data...";
        
        const memberSnap = await dbMember.collection('members').get();
        const members = memberSnap.docs.map(doc => doc.data());

        // Proses Data Member
        processMembers(members);

        // Update Status Akhir
        statusEl.innerText = "‚óè System Online: Connected to Reservasi & Member DB";
        statusEl.style.color = "#00ff99";
        statusEl.style.borderColor = "#00ff99";

    } catch (err) {
        console.error(err);
        statusEl.innerText = "Data Fetch Error: " + err.message;
        statusEl.style.color = "#ff3366";
    }
}

// --- FUNGSI PROSES DATA RESERVASI ---
function processReservations(data, menuDetails) {
    // 1. Hitung Menu Terlaris
    const menuCounts = {};
    data.forEach(r => {
        // Handle format baru (Array) dan lama (String)
        if (Array.isArray(r.menus)) {
            r.menus.forEach(m => {
                const name = m.name;
                const qty = parseInt(m.quantity) || 0;
                menuCounts[name] = (menuCounts[name] || 0) + qty;
            });
        } else if (r.menu) {
            menuCounts[r.menu] = (menuCounts[r.menu] || 0) + 1;
        }
    });

    // Sort Top 5
    const sortedMenus = Object.entries(menuCounts).sort((a,b) => b[1]-a[1]).slice(0, 5);
    
    // Render HTML
    const listEl = document.getElementById('topMenuList');
    listEl.innerHTML = "";
    document.getElementById('loadingMenu').style.display = 'none';

    if(sortedMenus.length === 0) listEl.innerHTML = "<li>Belum ada data pesanan.</li>";

    sortedMenus.forEach(([name, count], idx) => {
        // Ambil detail isian dari mapping menuDetails
        const details = menuDetails[name] ? menuDetails[name].join(', ') : 'Menu Spesial';
        
        listEl.innerHTML += `
            <li>
                <div class="menu-meta">
                    <span class="menu-name">#${idx+1} ${name}</span>
                    <span class="menu-desc">${details}</span>
                </div>
                <span class="menu-qty">${count}</span>
            </li>`;
    });

    // 2. Hitung Omzet DP per Bulan
    const monthlyRev = new Array(12).fill(0);
    const monthLabels = ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Ags", "Sep", "Okt", "Nov", "Des"];
    
    data.forEach(r => {
        if(r.date && r.dp) {
            const d = new Date(r.date);
            if(!isNaN(d)) monthlyRev[d.getMonth()] += parseInt(r.dp);
        }
    });

    // Render Chart Omzet
    document.getElementById('loadingRevenue').style.display = 'none';
    const ctx = document.getElementById('revenueChart').getContext('2d');
    
    Chart.defaults.color = 'rgba(255,255,255,0.7)';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: monthLabels,
            datasets: [{
                label: 'Omzet DP (Rp)',
                data: monthlyRev,
                borderColor: '#00ff99',
                backgroundColor: 'rgba(0, 255, 153, 0.1)',
                borderWidth: 3, tension: 0.3, fill: true,
                pointBackgroundColor: '#fff'
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { 
                legend: {display:false},
                tooltip: { callbacks: { label: (c) => 'Rp ' + c.parsed.y.toLocaleString('id-ID') } }
            },
            scales: { 
                x: {grid: {display:false}}, 
                y: {beginAtZero:true, ticks: { callback: (v) => (v/1000) + 'k' }} 
            }
        }
    });
}

// --- FUNGSI PROSES DATA MEMBER ---
function processMembers(data) {
    // 1. Statistik Dasar
    const total = data.length;
    const verified = data.filter(m => m.isVerified).length;
    const verifiedPercent = total > 0 ? Math.round((verified/total)*100) : 0;

    document.getElementById('totalMemberCount').innerText = total.toLocaleString();
    document.getElementById('verifiedMemberCount').innerText = verifiedPercent + "%";

    // 2. Grafik Sumber Info
    const sources = {};
    data.forEach(m => {
        const src = m.sumberInfo || 'Lainnya';
        sources[src] = (sources[src] || 0) + 1;
    });

    document.getElementById('loadingMember').style.display = 'none';
    const ctx = document.getElementById('memberSourceChart').getContext('2d');

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(sources),
            datasets: [{
                data: Object.values(sources),
                backgroundColor: ['#00ff99', '#33ccff', '#ff0050', '#ffffff'],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { 
                legend: { position: 'right', labels: {padding: 20, color:'#fff'} }
            }
        }
    });

    // 3. Analisis Alamat (Simple Parsing Kota/Kab)
    const addressCounts = {};
    data.forEach(m => {
        const addr = m.alamat || "";
        let region = "Lainnya";
        
        // Logika sederhana mendeteksi kota
        if(addr.toLowerCase().includes("semarang")) {
            region = addr.toLowerCase().includes("kab") ? "Kab. Semarang" : "Kota Semarang";
        } else if(addr.length < 3) {
            region = "Tidak Ada Data";
        } else {
            // Ambil kata pertama sebagai estimasi kota (bisa diperbaiki logicnya)
            region = "Luar Kota";
        }
        addressCounts[region] = (addressCounts[region] || 0) + 1;
    });

    // Sort Alamat
    const sortedAddr = Object.entries(addressCounts).sort((a,b) => b[1]-a[1]).slice(0, 3);
    const addrListEl = document.getElementById('addressList');
    addrListEl.innerHTML = "";

    sortedAddr.forEach(([loc, count]) => {
        const percent = Math.round((count/total)*100);
        addrListEl.innerHTML += `
            <li>
                <div class="menu-meta"><span class="menu-name">${loc}</span></div>
                <span class="menu-qty" style="font-size:1em">${percent}%</span>
            </li>
        `;
    });
}

// Jalankan Fetch Data saat halaman dimuat
fetchAllData();

</script>
</body>
</html>
